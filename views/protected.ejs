<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEKO Pora | Panel de Administraci√≥n</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Sora:wght@400;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Custom Registro M√©dico CSS -->
    <link rel="stylesheet" href="/css/registro-medico.css">

    <!-- Custom Especialidades CSS -->
    <link rel="stylesheet" href="/css/especialidades.css">

    <!-- Custom Pacientes CSS -->
    <link rel="stylesheet" href="/css/pacientes.css">

    <style>
        :root {
            --ink: #0f0b05;
            --paper: #fff9e6;
            --primary: #ffd02e;
            --primary-strong: #ffc700;
            --surface: #f4e8c5;
            --panel: #2b241a;
            --muted: rgba(15, 11, 5, 0.72);
            --border: rgba(15, 11, 5, 0.14);
            --success: #1c8c4a;
            --danger: #a02b2b;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(155deg, #fff9e6 0%, #fff3c4 42%, #ffe38d 100%);
            color: var(--ink);
            min-height: 100vh;
        }

        /* Navbar customization */
        .navbar {
            background: linear-gradient(135deg, rgba(255, 208, 46, 0.95), rgba(255, 199, 0, 0.92)) !important;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(255, 208, 46, 0.25);
        }

        .navbar-brand {
            font-family: 'Sora', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--panel) !important;
            letter-spacing: -0.02em;
        }

        .navbar-brand .brand-accent {
            color: var(--ink);
            font-weight: 400;
        }

        .nav-link {
            color: var(--panel) !important;
            font-weight: 500;
            transition: all 0.2s ease;
            border-radius: 8px;
            padding: 0.5rem 1rem !important;
            margin: 0 0.25rem;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .nav-link.active {
            background: rgba(43, 36, 26, 0.15) !important;
            font-weight: 600;
        }

        .btn-logout {
            background: var(--panel);
            color: var(--primary);
            border: none;
            font-weight: 600;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .btn-logout:hover {
            background: var(--ink);
            color: var(--primary-strong);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 11, 5, 0.3);
        }

        /* Main content */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 76px);
        }

        .welcome-card {
            background: linear-gradient(160deg, rgba(244, 232, 197, 0.92), rgba(255, 249, 230, 0.94));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(15, 11, 5, 0.12);
        }

        .welcome-card h1 {
            font-family: 'Sora', sans-serif;
            font-size: 2rem;
            color: var(--panel);
            margin-bottom: 0.5rem;
        }

        .welcome-card p {
            color: var(--muted);
            margin-bottom: 0;
        }

        /* Management cards */
        .management-card {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.75rem;
            transition: all 0.3s ease;
            height: 100%;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .management-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(255, 208, 46, 0.25);
            border-color: var(--primary-strong);
        }

        .management-card .icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--ink);
            margin-bottom: 1rem;
        }

        .management-card h3 {
            font-family: 'Sora', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--panel);
            margin-bottom: 0.5rem;
        }

        .management-card p {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        .management-card .arrow {
            margin-top: 1rem;
            color: var(--primary-strong);
            font-size: 1.25rem;
            transition: transform 0.2s ease;
        }

        .management-card:hover .arrow {
            transform: translateX(4px);
        }

        /* Section content */
        .section-header {
            background: linear-gradient(160deg, rgba(244, 232, 197, 0.92), rgba(255, 249, 230, 0.94));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            font-family: 'Sora', sans-serif;
            font-size: 1.75rem;
            color: var(--panel);
            margin-bottom: 0.5rem;
        }

        .section-header p {
            color: var(--muted);
            margin-bottom: 0;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 24px rgba(15, 11, 5, 0.08);
        }

        /* Responsive adjustments */
        @media (max-width: 991px) {
            .navbar-collapse {
                background: rgba(255, 249, 230, 0.98);
                border-radius: 12px;
                padding: 1rem;
                margin-top: 1rem;
                border: 1px solid var(--border);
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* M√©dicos Section Styles */
        .medicos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
            gap: 2rem;
        }

        .medicos-header h4 {
            font-family: 'Sora', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--panel);
            margin: 0;
        }

        .search-filter-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-specialty {
            min-width: 220px;
        }

        .filter-specialty select {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            border: 1.5px solid var(--border);
            font-family: 'Manrope', sans-serif;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.98);
            transition: all 0.25s ease;
        }

        .filter-specialty select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }

        .medicos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .medico-card {
            background: rgba(255, 255, 255, 0.98);
            border: 1.5px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

        .medico-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.15);
        }

        .medico-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(180deg, var(--primary), var(--primary-strong));
            transition: width 0.25s ease;
        }

        .medico-card:hover::before {
            width: 4px;
        }

        .medico-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--ink);
            font-weight: 700;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }

        .medico-name {
            font-family: 'Sora', sans-serif;
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--panel);
            margin-bottom: 0.25rem;
        }

        .medico-specialty {
            color: var(--primary-strong);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .medico-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .medico-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--muted);
        }

        .medico-info-item i {
            color: var(--primary-strong);
            font-size: 1rem;
        }

        .medico-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn-back {
            background: transparent;
            border: 1.5px solid var(--border);
            color: var(--panel);
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            font-family: 'Manrope', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-back:hover {
            background: rgba(251, 191, 36, 0.05);
            border-color: var(--primary);
            transform: translateX(-4px);
        }

        @media (max-width: 768px) {
            .medicos-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-filter-bar {
                flex-direction: column;
                width: 100%;
            }

            .search-box,
            .filter-specialty {
                width: 100%;
                min-width: 100%;
            }

            .medicos-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Modal Styles - HEKO PORA Custom Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 11, 5, 0.75);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeInOverlay 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeInOverlay {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-container {
            background: linear-gradient(160deg, rgba(255, 249, 230, 0.98), rgba(244, 232, 197, 0.96));
            border: 2px solid var(--border);
            border-radius: 24px;
            max-width: 480px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 60px rgba(15, 11, 5, 0.4),
                0 0 0 1px rgba(255, 208, 46, 0.15);
            animation: modalSlideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.92);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
        }

        .modal-glow.danger {
            background: #DC2626;
            top: -100px;
            right: -100px;
        }

        .modal-glow.warning {
            background: #F59E0B;
            top: -100px;
            right: -100px;
        }

        .modal-glow.info {
            background: var(--primary);
            bottom: -100px;
            left: -100px;
        }

        .modal-content {
            position: relative;
            z-index: 1;
            padding: 2.5rem 2rem;
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        .modal-icon.danger {
            background: linear-gradient(135deg, #FCA5A5, #DC2626);
            color: #7F1D1D;
            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.35);
        }

        .modal-icon.warning {
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            color: var(--ink);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.35);
        }

        @keyframes iconPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .modal-title {
            font-family: 'Sora', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--panel);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .modal-message {
            color: var(--muted);
            text-align: center;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .modal-detail-box {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .modal-detail-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .modal-detail-value {
            font-family: 'Sora', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--panel);
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .modal-btn {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-family: 'Manrope', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.8);
            border: 1.5px solid var(--border);
            color: var(--panel);
        }

        .modal-btn-cancel:hover {
            background: rgba(255, 255, 255, 1);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 11, 5, 0.1);
        }

        .modal-btn-danger {
            background: linear-gradient(135deg, #DC2626, #991B1B);
            color: white;
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
        }

        .modal-btn-danger:hover {
            background: linear-gradient(135deg, #B91C1C, #7F1D1D);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.45);
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            color: var(--ink);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
        }

        .modal-btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-strong), #F59E0B);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.45);
        }

        .modal-btn:active {
            transform: translateY(0);
        }

        .modal-btn i {
            font-size: 1.1rem;
        }

        /* Loading state for modal buttons */
        .modal-btn.loading {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
        }

        .modal-btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid currentColor;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive modal */
        @media (max-width: 576px) {
            .modal-container {
                max-width: 95%;
                border-radius: 20px;
            }

            .modal-content {
                padding: 2rem 1.5rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .modal-actions {
                flex-direction: column;
            }

            .modal-btn {
                width: 100%;
            }
        }

        /* Medico Details Modal Styles */
        .modal-details {
            max-width: 700px;
        }

        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: 1.5px solid var(--border);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .modal-close-btn:hover {
            background: var(--primary);
            border-color: var(--primary-strong);
            transform: rotate(90deg) scale(1.1);
        }

        .modal-close-btn i {
            font-size: 1rem;
            color: var(--panel);
        }

        .medico-details-content {
            max-height: 60vh;
            overflow-y: auto;
            margin: 1.5rem 0;
            padding-right: 0.5rem;
        }

        .medico-details-content::-webkit-scrollbar {
            width: 6px;
        }

        .medico-details-content::-webkit-scrollbar-track {
            background: rgba(15, 11, 5, 0.05);
            border-radius: 10px;
        }

        .medico-details-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .medico-details-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-strong);
        }

        .details-section {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .details-section:last-child {
            margin-bottom: 0;
        }

        .section-header-small {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Sora', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--panel);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary);
        }

        .section-header-small i {
            font-size: 1.1rem;
            color: var(--primary-strong);
        }

        .details-table {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: 1rem;
            align-items: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .detail-row:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(4px);
        }

        .detail-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .detail-label i {
            font-size: 1rem;
            color: var(--primary-strong);
        }

        .detail-value {
            font-family: 'Manrope', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--panel);
        }

        .detail-value.specialty-badge {
            background: linear-gradient(135deg, var(--primary), var(--primary-strong));
            color: var(--ink);
            padding: 0.4rem 0.9rem;
            border-radius: 8px;
            font-weight: 700;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }

        .dias-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .dia-badge {
            background: rgba(255, 255, 255, 0.9);
            border: 1.5px solid var(--primary);
            color: var(--panel);
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        @media (max-width: 576px) {
            .modal-details {
                max-width: 95%;
            }

            .detail-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                text-align: left;
            }

            .detail-label {
                font-size: 0.75rem;
            }

            .detail-value {
                font-size: 0.9rem;
            }

            .medico-details-content {
                max-height: 50vh;
            }
        }
    </style>
</head>

<body>
    <% const usernameQuery=name ? `?username=${encodeURIComponent(name)}` : '' ; %>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="/protected<%= usernameQuery %>">
                    HEKO <span class="brand-accent">PORA</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link <%= section === 'dashboard' ? 'active' : '' %>"
                                href="/protected<%= usernameQuery %>">
                                <i class="bi bi-speedometer2 me-1"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= section === 'pacientes' ? 'active' : '' %>"
                                href="/admin/pacientes<%= usernameQuery %>">
                                <i class="bi bi-people me-1"></i> Pacientes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= section === 'medicos' ? 'active' : '' %>"
                                href="/admin/medicos<%= usernameQuery %>">
                                <i class="bi bi-person-badge me-1"></i> M√©dicos
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= section === 'especialidades' ? 'active' : '' %>"
                                href="/admin/especialidades<%= usernameQuery %>">
                                <i class="bi bi-heart-pulse me-1"></i> Especialidades
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= section === 'consultorios' ? 'active' : '' %>"
                                href="/admin/consultorios<%= usernameQuery %>">
                                <i class="bi bi-building me-1"></i> Consultorios
                            </a>
                        </li>
                    </ul>
                    <form action="/logout" method="POST" class="d-flex">
                        <button class="btn btn-logout" type="submit">
                            <i class="bi bi-box-arrow-right me-1"></i> Cerrar Sesi√≥n
                        </button>
                    </form>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
                <% if (section==='dashboard' ) { %>
                    <!-- Dashboard View -->
                    <div class="welcome-card fade-in">
                        <h1>Bienvenido, <%= name %>
                        </h1>
                        <p>Sistema Web de Gesti√≥n de Consultorio centralizado</p>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6 col-lg-3">
                            <a href="/admin/pacientes<%= usernameQuery %>" class="management-card fade-in">
                                <div class="icon">
                                    <i class="bi bi-people"></i>
                                </div>
                                <h3>Pacientes</h3>
                                <p>Gestiona el registro y datos de pacientes</p>
                                <div class="arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-6 col-lg-3">
                            <a href="/admin/medicos<%= usernameQuery %>" class="management-card fade-in">
                                <div class="icon">
                                    <i class="bi bi-person-badge"></i>
                                </div>
                                <h3>M√©dicos</h3>
                                <p>Administra profesionales y especialistas</p>
                                <div class="arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-6 col-lg-3">
                            <a href="/admin/especialidades<%= usernameQuery %>" class="management-card fade-in">
                                <div class="icon">
                                    <i class="bi bi-heart-pulse"></i>
                                </div>
                                <h3>Especialidades</h3>
                                <p>Configura especialidades m√©dicas</p>
                                <div class="arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-6 col-lg-3">
                            <a href="/admin/consultorios<%= usernameQuery %>" class="management-card fade-in">
                                <div class="icon">
                                    <i class="bi bi-building"></i>
                                </div>
                                <h3>Consultorios</h3>
                                <p>Gestiona salas y espacios m√©dicos</p>
                                <div class="arrow">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </a>
                        </div>
                    </div>

                    <% } else if (section==='pacientes' ) { %>
                        <!-- Pacientes Section -->
                        <div class="section-header fade-in">
                            <h2><i class="bi bi-people me-2"></i> Gesti√≥n de Pacientes</h2>
                            <p>Administra el registro y datos de pacientes del centro m√©dico</p>
                        </div>
                        <div class="content-card fade-in pacientes-grid">
                            <div class="paciente-form-panel">
                                <div class="panel-header">
                                    <div class="header-icon-small">
                                        <i class="bi bi-person-plus-fill"></i>
                                    </div>
                                    <div>
                                        <h4>Registrar Paciente</h4>
                                        <p class="panel-subtitle">Captura los datos b√°sicos y da de alta al paciente</p>
                                    </div>
                                </div>

                                <form id="pacienteForm" class="paciente-form" novalidate>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteNombre">Nombre</label>
                                            <input class="form-control-custom" id="pacienteNombre" name="nombre"
                                                required placeholder="Ej. Ana">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteApellido">Apellido</label>
                                            <input class="form-control-custom" id="pacienteApellido" name="apellido"
                                                required placeholder="Ej. Gonz√°lez">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteDocumento">Documento
                                                (opcional)</label>
                                            <input class="form-control-custom" id="pacienteDocumento" name="idDocumento"
                                                inputmode="numeric" pattern="[0-9]*"
                                                placeholder="Temporalmente deshabilitado" disabled>
                                            <small class="field-hint">‚ö†Ô∏è Deshabilitado hasta implementar gesti√≥n de
                                                documentos</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteHistorial">N¬∞ Historial
                                                (opcional)</label>
                                            <input class="form-control-custom" id="pacienteHistorial" name="idHistorial"
                                                inputmode="numeric" pattern="[0-9]*"
                                                placeholder="Temporalmente deshabilitado" disabled>
                                            <small class="field-hint">‚ö†Ô∏è Deshabilitado hasta implementar gesti√≥n de
                                                historiales</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteNacimiento">Fecha de
                                                nacimiento</label>
                                            <input class="form-control-custom" id="pacienteNacimiento"
                                                name="fechaNacimiento" type="date" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteSexo">Sexo</label>
                                            <select class="form-control-custom" id="pacienteSexo" name="sexo" required>
                                                <option value="H">Hombre</option>
                                                <option value="M" selected>Mujer</option>
                                            </select>
                                            <small class="field-hint">Valores v√°lidos en BD: H / M</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteLugar">Lugar de nacimiento</label>
                                            <input class="form-control-custom" id="pacienteLugar" name="lugarNacimiento"
                                                required placeholder="Ciudad, Pa√≠s">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label" for="pacienteProfesion">Profesi√≥n
                                                (opcional)</label>
                                            <input class="form-control-custom" id="pacienteProfesion" name="profesion"
                                                placeholder="Ej. Abogada">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label" for="pacienteDireccion">Direcci√≥n</label>
                                            <textarea class="form-control-custom textarea-custom" id="pacienteDireccion"
                                                name="direccion" rows="2" required
                                                placeholder="Calle, n√∫mero, barrio"></textarea>
                                        </div>
                                    </div>

                                    <div class="form-actions-inline mt-4">
                                        <button type="reset" class="btn-secondary-custom">
                                            <i class="bi bi-arrow-counterclockwise me-2"></i>
                                            Limpiar
                                        </button>
                                        <button type="submit" class="btn-primary-custom">
                                            <i class="bi bi-check-circle me-2"></i>
                                            Guardar paciente
                                        </button>
                                    </div>
                                    <div id="pacienteFormStatus" class="form-message" style="display: none;"></div>
                                </form>
                            </div>

                            <div class="paciente-list-panel">
                                <div class="list-header">
                                    <div>
                                        <h5>Pacientes recientes</h5>
                                        <p class="text-muted mb-0"><span id="pacientesCount">0</span> registrados</p>
                                    </div>
                                    <div class="list-actions">
                                        <button id="refreshPacientes" class="btn-secondary-custom" type="button">
                                            <i class="bi bi-arrow-repeat me-1"></i>
                                            Actualizar
                                        </button>
                                    </div>
                                </div>
                                <div class="paciente-table-wrapper">
                                    <table class="table paciente-table align-middle">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nombre</th>
                                                <th>Nacimiento</th>
                                                <th>Lugar</th>
                                                <th>Direcci√≥n</th>
                                                <th>Sexo</th>
                                                <th>Profesi√≥n</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="pacientesTableBody">
                                            <tr class="empty-row">
                                                <td colspan="7">
                                                    <div class="empty-state">
                                                        <div class="empty-icon"><i class="bi bi-inbox"></i></div>
                                                        <p>Sin pacientes cargados</p>
                                                        <small>Registra el primero para verlo aqu√≠</small>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <% } else if (section==='medicos' ) { %>
                            <!-- M√©dicos Section -->
                            <div class="section-header fade-in">
                                <h2><i class="bi bi-person-badge me-2"></i> Gesti√≥n de M√©dicos</h2>
                                <p>Administra profesionales m√©dicos y especialistas</p>
                            </div>

                            <!-- M√©dicos List View -->
                            <div id="medicosListView" class="content-card fade-in">
                                <div class="medicos-header">
                                    <div>
                                        <h4><i class="bi bi-people-fill me-2"></i>M√©dicos Registrados</h4>
                                        <p class="text-muted mb-0"><span id="medicosCount">0</span> profesionales
                                            activos</p>
                                    </div>
                                    <button id="btnAgregarMedico" class="btn-primary-custom">
                                        <i class="bi bi-person-plus-fill me-2"></i>
                                        <span>Agregar M√©dico</span>
                                    </button>
                                </div>

                                <div class="search-filter-bar mt-4">
                                    <div class="search-box">
                                        <i class="bi bi-search"></i>
                                        <input type="text" id="searchMedico" placeholder="Buscar m√©dico..." />
                                    </div>
                                    <div class="filter-specialty">
                                        <select id="filterEspecialidad" class="form-control-custom">
                                            <option value="">Todas las especialidades</option>
                                            <option value="cardiologia">Cardiolog√≠a</option>
                                            <option value="pediatria">Pediatr√≠a</option>
                                            <option value="traumatologia">Traumatolog√≠a</option>
                                            <option value="ginecologia">Ginecolog√≠a</option>
                                            <option value="oftalmologia">Oftalmolog√≠a</option>
                                            <option value="neurologia">Neurolog√≠a</option>
                                            <option value="dermatologia">Dermatolog√≠a</option>
                                            <option value="medicina-general">Medicina General</option>
                                        </select>
                                    </div>
                                </div>

                                <div id="medicosList" class="medicos-grid mt-4">
                                    <!-- M√©dicos cards will be inserted here -->
                                    <div class="empty-state">
                                        <div class="empty-icon">
                                            <i class="bi bi-person-x"></i>
                                        </div>
                                        <p>No hay m√©dicos registrados</p>
                                        <small>Comienza agregando un nuevo profesional m√©dico</small>
                                    </div>
                                </div>
                            </div>

                            <!-- M√©dicos Form View (hidden by default) -->
                            <div id="medicosFormView" class="content-card fade-in registro-medico-container"
                                style="display: none;">
                                <!-- Back button -->
                                <button id="btnVolverLista" class="btn-back mb-3">
                                    <i class="bi bi-arrow-left me-2"></i>
                                    <span>Volver a la lista</span>
                                </button>

                                <!-- Registration Form -->
                                <div class="registro-medico-wrapper">
                                    <div class="form-header">
                                        <div class="header-icon">
                                            <i class="bi bi-person-plus-fill"></i>
                                        </div>
                                        <h3>Registrar Nuevo M√©dico</h3>
                                        <p class="header-subtitle">Completa los datos del profesional m√©dico</p>
                                    </div>

                                    <form id="registroMedicoForm" class="registro-medico-form">
                                        <!-- Hidden field for edit mode -->
                                        <input type="hidden" id="medicoId" name="medicoId" value="">
                                        <!-- Personal Information Section -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="bi bi-person-circle"></i>
                                                <span>Informaci√≥n Personal</span>
                                            </div>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="nombre" name="nombre" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="nombre">Nombre(s)</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="apellido" name="apellido" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="apellido">Apellido(s)</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mt-2">
                                                <div class="col-md-4">
                                                    <div class="form-floating-custom">
                                                        <select id="tipoDocumento" name="tipoDocumento" required
                                                            class="form-control-custom tipo-documento-select">
                                                            <option value="" disabled selected></option>
                                                            <option value="cedula">ü™™ C√©dula</option>
                                                            <option value="dni">üÜî DNI</option>
                                                            <option value="pasaporte">üõÇ Pasaporte</option>
                                                        </select>
                                                        <label for="tipoDocumento">Tipo de Documento</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">Selecciona el tipo</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="dni" name="dni" required
                                                            pattern="[0-9]{7,12}" class="form-control-custom"
                                                            placeholder=" ">
                                                        <label for="dni">N√∫mero de Documento</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">Solo n√∫meros</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-floating-custom">
                                                        <input type="date" id="fechaNacimiento" name="fechaNacimiento"
                                                            required class="form-control-custom" placeholder=" "
                                                            max="<%= new Date().toISOString().split('T')[0] %>">
                                                        <label for="fechaNacimiento">Fecha de Nacimiento</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">No puede ser mayor a hoy</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Professional Information Section -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="bi bi-briefcase-fill"></i>
                                                <span>Informaci√≥n Profesional</span>
                                            </div>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="matricula" name="matricula" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="matricula">Matr√≠cula Profesional</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">N√∫mero de matr√≠cula vigente</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <select id="especialidad" name="especialidad" required
                                                            class="form-control-custom">
                                                            <option value="" disabled selected></option>
                                                            <option value="cardiologia">Cardiolog√≠a</option>
                                                            <option value="pediatria">Pediatr√≠a</option>
                                                            <option value="traumatologia">Traumatolog√≠a</option>
                                                            <option value="ginecologia">Ginecolog√≠a</option>
                                                            <option value="oftalmologia">Oftalmolog√≠a</option>
                                                            <option value="neurologia">Neurolog√≠a</option>
                                                            <option value="dermatologia">Dermatolog√≠a</option>
                                                            <option value="medicina-general">Medicina General</option>
                                                        </select>
                                                        <label for="especialidad">Especialidad M√©dica</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mt-2">
                                                <div class="col-12">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="tituloProfesional"
                                                            name="tituloProfesional" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="tituloProfesional">T√≠tulo Profesional</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">Ej: M√©dico Cirujano, Especialista
                                                            en...</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Contact Information Section -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="bi bi-envelope-at-fill"></i>
                                                <span>Datos de Contacto</span>
                                            </div>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="email" id="email" name="email" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="email">Correo Electr√≥nico</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="tel" id="telefono" name="telefono" required
                                                            pattern="[0-9]{10}" class="form-control-custom"
                                                            placeholder=" ">
                                                        <label for="telefono">Tel√©fono / Celular</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">10 d√≠gitos sin espacios</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row g-3 mt-2">
                                                <div class="col-12">
                                                    <div class="form-floating-custom">
                                                        <textarea id="direccion" name="direccion" required
                                                            class="form-control-custom textarea-custom" placeholder=" "
                                                            rows="3"></textarea>
                                                        <label for="direccion">Direcci√≥n</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Schedule and Availability Section -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="bi bi-clock-fill"></i>
                                                <span>Horarios de Atenci√≥n</span>
                                            </div>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="time" id="horaInicio" name="horaInicio" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="horaInicio">Hora de Inicio</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating-custom">
                                                        <input type="time" id="horaFin" name="horaFin" required
                                                            class="form-control-custom" placeholder=" ">
                                                        <label for="horaFin">Hora de Finalizaci√≥n</label>
                                                        <div class="input-border"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="dias-atencion mt-3">
                                                <label class="dias-label">D√≠as de Atenci√≥n</label>
                                                <div class="dias-grid">
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="lunes" name="dias[]" value="lunes">
                                                        <label for="lunes">Lunes</label>
                                                    </div>
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="martes" name="dias[]" value="martes">
                                                        <label for="martes">Martes</label>
                                                    </div>
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="miercoles" name="dias[]"
                                                            value="miercoles">
                                                        <label for="miercoles">Mi√©rcoles</label>
                                                    </div>
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="jueves" name="dias[]" value="jueves">
                                                        <label for="jueves">Jueves</label>
                                                    </div>
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="viernes" name="dias[]"
                                                            value="viernes">
                                                        <label for="viernes">Viernes</label>
                                                    </div>
                                                    <div class="dia-checkbox">
                                                        <input type="checkbox" id="sabado" name="dias[]" value="sabado">
                                                        <label for="sabado">S√°bado</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Form Actions -->
                                        <div class="form-actions">
                                            <button type="button" class="btn-secondary-custom">
                                                <i class="bi bi-x-circle me-2"></i>
                                                <span>Cancelar</span>
                                            </button>
                                            <button type="submit" class="btn-primary-custom">
                                                <i class="bi bi-check-circle me-2"></i>
                                                <span>Registrar M√©dico</span>
                                            </button>
                                        </div>
                                    </form>

                                    <!-- Success/Error Message -->
                                    <div id="formMessage" class="form-message" style="display: none;"></div>
                                </div>
                            </div>

                            <% } else if (section==='especialidades' ) { %>
                                <!-- Especialidades Section -->
                                <div class="section-header fade-in">
                                    <h2><i class="bi bi-heart-pulse me-2"></i> Gesti√≥n de Especialidades M√©dicas</h2>
                                    <p>Configura y administra las especialidades disponibles en el centro m√©dico</p>
                                </div>

                                <div class="content-card fade-in especialidades-container">
                                    <!-- Dual Panel Layout -->
                                    <div class="especialidades-grid">
                                        <!-- Left Panel: Add New Specialty -->
                                        <div class="specialty-form-panel">
                                            <div class="panel-header">
                                                <div class="header-icon-small">
                                                    <i class="bi bi-plus-circle-fill"></i>
                                                </div>
                                                <h4>Nueva Especialidad</h4>
                                                <p class="panel-subtitle">Registra una nueva especialidad m√©dica</p>
                                            </div>

                                            <form id="especialidadForm" class="specialty-form">
                                                <!-- Hidden field for edit mode -->
                                                <input type="hidden" id="especialidadId" name="especialidadId" value="">

                                                <div class="form-floating-custom">
                                                    <input type="text" id="nombreEspecialidad" name="nombre" required
                                                        class="form-control-custom" placeholder=" " maxlength="100">
                                                    <label for="nombreEspecialidad">Nombre de la Especialidad</label>
                                                    <div class="input-border"></div>
                                                    <small class="field-hint">Ej: Cardiolog√≠a, Pediatr√≠a,
                                                        Neurolog√≠a</small>
                                                </div>
                                                <form id="especialidadForm" class="specialty-form">
                                                    <div class="form-floating-custom">
                                                        <input type="text" id="nombreEspecialidad" name="nombre"
                                                            required class="form-control-custom" placeholder=" "
                                                            maxlength="100">
                                                        <label for="nombreEspecialidad">Nombre de la
                                                            Especialidad</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">Ej: Cardiolog√≠a, Pediatr√≠a,
                                                            Neurolog√≠a</small>
                                                    </div>

                                                    <div class="form-floating-custom mt-3">
                                                        <textarea id="descripcionEspecialidad" name="descripcion"
                                                            class="form-control-custom textarea-custom" placeholder=" "
                                                            rows="4" maxlength="500"></textarea>
                                                        <label for="descripcionEspecialidad">Descripci√≥n
                                                            (opcional)</label>
                                                        <div class="input-border"></div>
                                                        <small class="field-hint">Descripci√≥n breve del √°rea
                                                            m√©dica</small>
                                                    </div>

                                                    <div class="form-floating-custom mt-3">
                                                        <select id="iconoEspecialidad" name="icono"
                                                            class="form-control-custom">
                                                            <option value="" disabled selected></option>
                                                            <option value="heart-pulse">üíì Cardiolog√≠a / Coraz√≥n
                                                            </option>
                                                            <option value="bandaid">ü©π Medicina General</option>
                                                            <option value="brain">üß† Neurolog√≠a</option>
                                                            <option value="lungs">ü´Å Neumolog√≠a</option>
                                                            <option value="eye">üëÅÔ∏è Oftalmolog√≠a</option>
                                                            <option value="ear">üëÇ Otorrinolaringolog√≠a</option>
                                                            <option value="bone">ü¶¥ Traumatolog√≠a</option>
                                                            <option value="baby">üë∂ Pediatr√≠a</option>
                                                            <option value="gender-female">ü§∞ Ginecolog√≠a</option>
                                                            <option value="tooth">ü¶∑ Odontolog√≠a</option>
                                                            <option value="skin">üî¨ Dermatolog√≠a</option>
                                                            <option value="kidney">ü´ò Nefrolog√≠a</option>
                                                            <option value="stomach">ü´É Gastroenterolog√≠a</option>
                                                        </select>
                                                        <label for="iconoEspecialidad">Icono Representativo</label>
                                                        <div class="input-border"></div>
                                                    </div>

                                                    <div class="form-actions-inline mt-4">
                                                        <button type="submit" class="btn-primary-custom">
                                                            <i class="bi bi-check-circle me-2"></i>
                                                            <span>Agregar Especialidad</span>
                                                        </button>
                                                        <button type="button" class="btn-secondary-custom"
                                                            onclick="resetEspecialidadForm()">
                                                            <i class="bi bi-arrow-clockwise me-2"></i>
                                                            <span>Limpiar</span>
                                                        </button>
                                                    </div>
                                                </form>

                                                <div id="specialtyFormMessage" class="form-message"
                                                    style="display: none;">
                                                </div>
                                        </div>

                                        <!-- Right Panel: Specialties List -->
                                        <div class="specialty-list-panel">
                                            <div class="panel-header">
                                                <div class="header-flex">
                                                    <div>
                                                        <div class="header-icon-small">
                                                            <i class="bi bi-list-ul"></i>
                                                        </div>
                                                        <h4>Especialidades Registradas</h4>
                                                        <p class="panel-subtitle">
                                                            <span id="specialtyCount">0</span> especialidades activas
                                                        </p>
                                                    </div>
                                                    <div class="search-box">
                                                        <i class="bi bi-search"></i>
                                                        <input type="text" id="searchSpecialty"
                                                            placeholder="Buscar..." />
                                                    </div>
                                                </div>
                                            </div>

                                            <div id="specialtiesList" class="specialties-list">
                                                <!-- Specialty cards will be inserted here dynamically -->
                                                <div class="empty-state">
                                                    <div class="empty-icon">
                                                        <i class="bi bi-inbox"></i>
                                                    </div>
                                                    <p>No hay especialidades registradas</p>
                                                    <small>Comienza agregando una nueva especialidad</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <% } else if (section==='consultorios' ) { %>
                                    <!-- Consultorios Section -->
                                    <div class="section-header fade-in">
                                        <h2><i class="bi bi-building me-2"></i> Gesti√≥n de Consultorios</h2>
                                        <p>Administra salas y espacios de consulta m√©dica</p>
                                    </div>
                                    <div class="content-card fade-in">
                                        <p class="text-muted">Aqu√≠ podr√°s gestionar los consultorios y salas
                                            disponibles.
                                        </p>
                                        <!-- TODO: Add consultation room management table/forms here -->
                                    </div>

                                    <% } %>
            </div>
        </div>

        <!-- Custom Modals -->
        <div id="confirmModal" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-glow danger"></div>
                <div class="modal-glow info"></div>
                <div class="modal-content">
                    <div class="modal-icon danger">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                    </div>
                    <h3 class="modal-title" id="modalTitle">¬øConfirmar acci√≥n?</h3>
                    <p class="modal-message" id="modalMessage">Esta acci√≥n no se puede deshacer.</p>
                    <div id="modalDetailBox" class="modal-detail-box" style="display: none;">
                        <div class="modal-detail-label" id="modalDetailLabel">Elemento</div>
                        <div class="modal-detail-value" id="modalDetailValue">-</div>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-btn modal-btn-cancel" id="modalCancel">
                            <i class="bi bi-x-circle"></i>
                            <span>Cancelar</span>
                        </button>
                        <button class="modal-btn modal-btn-danger" id="modalConfirm">
                            <i class="bi bi-check-circle"></i>
                            <span>Confirmar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medico Details Modal -->
        <div id="medicoDetailsModal" class="modal-overlay">
            <div class="modal-container modal-details">
                <div class="modal-glow info" style="background: var(--primary);"></div>
                <div class="modal-content">
                    <button class="modal-close-btn" id="closeMedicoDetails">
                        <i class="bi bi-x-lg"></i>
                    </button>
                    <div class="modal-icon warning">
                        <i class="bi bi-person-badge-fill"></i>
                    </div>
                    <h3 class="modal-title" id="medicoDetailsName">Detalles del M√©dico</h3>

                    <div class="medico-details-content">
                        <!-- Personal Information Section -->
                        <div class="details-section">
                            <div class="section-header-small">
                                <i class="bi bi-person-circle"></i>
                                <span>Informaci√≥n Personal</span>
                            </div>
                            <div class="details-table">
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-card-text"></i>
                                        <span>Documento</span>
                                    </div>
                                    <div class="detail-value" id="detailDocumento">-</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-calendar3"></i>
                                        <span>Fecha de Nacimiento</span>
                                    </div>
                                    <div class="detail-value" id="detailFechaNacimiento">-</div>
                                </div>
                                <div class="detail-row" id="detailEdadRow" style="display: none;">
                                    <div class="detail-label">
                                        <i class="bi bi-person"></i>
                                        <span>Edad</span>
                                    </div>
                                    <div class="detail-value" id="detailEdad">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Information Section -->
                        <div class="details-section">
                            <div class="section-header-small">
                                <i class="bi bi-briefcase-fill"></i>
                                <span>Informaci√≥n Profesional</span>
                            </div>
                            <div class="details-table">
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-heart-pulse"></i>
                                        <span>Especialidad</span>
                                    </div>
                                    <div class="detail-value specialty-badge" id="detailEspecialidad">-</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-award"></i>
                                        <span>Matr√≠cula</span>
                                    </div>
                                    <div class="detail-value" id="detailMatricula">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- Schedule Section -->
                        <div class="details-section">
                            <div class="section-header-small">
                                <i class="bi bi-clock-fill"></i>
                                <span>Horario de Atenci√≥n</span>
                            </div>
                            <div class="details-table">
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-alarm"></i>
                                        <span>Horario</span>
                                    </div>
                                    <div class="detail-value" id="detailHorario">-</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-calendar-week"></i>
                                        <span>D√≠as de Atenci√≥n</span>
                                    </div>
                                    <div class="detail-value">
                                        <div id="detailDias" class="dias-badges">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="details-section">
                            <div class="section-header-small">
                                <i class="bi bi-envelope-at-fill"></i>
                                <span>Informaci√≥n de Contacto</span>
                            </div>
                            <div class="details-table">
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-envelope"></i>
                                        <span>Email</span>
                                    </div>
                                    <div class="detail-value" id="detailEmail">-</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">
                                        <i class="bi bi-telephone"></i>
                                        <span>Tel√©fono</span>
                                    </div>
                                    <div class="detail-value" id="detailTelefono">-</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="modal-btn modal-btn-primary" id="closeDetailBtn">
                            <i class="bi bi-check-circle"></i>
                            <span>Cerrar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap 5 JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Pacientes Management Script -->
        <script>
            const pacientesState = {
                rows: []
            }

            function formatDateEs(value) {
                if (!value) return '-'
                const date = new Date(value)
                if (Number.isNaN(date.getTime())) return value
                return new Intl.DateTimeFormat('es-AR', { year: 'numeric', month: 'short', day: 'numeric' }).format(date)
            }

            function showPacienteStatus(message, type = 'info') {
                const statusEl = document.getElementById('pacienteFormStatus')
                if (!statusEl) return
                statusEl.textContent = message
                statusEl.className = `form-message ${type}`
                statusEl.style.display = message ? 'block' : 'none'
            }

            function renderPacientes() {
                const tableBody = document.getElementById('pacientesTableBody')
                const countEl = document.getElementById('pacientesCount')
                if (!tableBody) return

                const rows = pacientesState.rows ?? []
                if (countEl) countEl.textContent = rows.length

                if (rows.length === 0) {
                    tableBody.innerHTML = `
                    <tr class="empty-row">
                        <td colspan="8">
                            <div class="empty-state">
                                <div class="empty-icon"><i class="bi bi-inbox"></i></div>
                                <p>Sin pacientes cargados</p>
                                <small>Registra el primero para verlo aqu√≠</small>
                            </div>
                        </td>
                    </tr>
                `
                    return
                }

                tableBody.innerHTML = rows.map(paciente => {
                    const sexo = paciente.SEXO ?? paciente.sexo ?? 'M'

                    return `
                    <tr>
                        <td class="id-cell">${paciente.ID_PACIENTE ?? paciente.id_paciente ?? paciente.id ?? '‚Äî'}</td>
                        <td>
                            <div class="stacked">
                                <strong>${paciente.NOMBRE ?? paciente.nombre ?? ''} ${paciente.APELLIDO ?? paciente.apellido ?? ''}</strong>
                                <small class="muted">${paciente.LUGAR_NACIMIENTO ?? paciente.lugar_nacimiento ?? ''}</small>
                            </div>
                        </td>
                        <td>${formatDateEs(paciente.FECHA_NACIMIENTO ?? paciente.fecha_nacimiento)}</td>
                        <td>${paciente.LUGAR_NACIMIENTO ?? paciente.lugar_nacimiento ?? '‚Äî'}</td>
                        <td><span class="badge-soft">${paciente.DIRECCION ?? paciente.direccion ?? '‚Äî'}</span></td>
                        <td><span class="chip ${sexo === 'H' ? 'chip-info' : 'chip-primary'}">${sexo}</span></td>
                        <td>${paciente.PROFESION ?? paciente.profesion ?? '‚Äî'}</td>
                        <td>
                            <button class="btn-icon-action danger" onclick="deletePaciente(${paciente.ID_PACIENTE ?? paciente.id_paciente ?? paciente.id})" title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
                }).join('')
            }

            async function fetchPacientes() {
                const tableBody = document.getElementById('pacientesTableBody')
                if (tableBody) {
                    tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="loading-row">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Cargando pacientes...
                        </td>
                    </tr>
                `
                }

                try {
                    console.log('Fetching pacientes...')
                    const response = await fetch('/api/pacientes')
                    console.log('Response status:', response.status)
                    const payload = await response.json()
                    console.log('Payload:', payload)
                    if (!response.ok) {
                        throw new Error(payload.error || 'No se pudieron obtener los pacientes.')
                    }
                    pacientesState.rows = payload.data || []
                    renderPacientes()
                } catch (error) {
                    showPacienteStatus(error.message, 'error')
                }
            }

            function initPacientes() {
                const form = document.getElementById('pacienteForm')
                if (!form) return

                const submitBtn = form.querySelector('button[type="submit"]')
                const refreshBtn = document.getElementById('refreshPacientes')
                const docInput = document.getElementById('pacienteDocumento')
                const histInput = document.getElementById('pacienteHistorial')
                const sexoSelect = document.getElementById('pacienteSexo')

                    ;[docInput, histInput].forEach(input => {
                        input?.addEventListener('input', function () {
                            this.value = this.value.replace(/\D/g, '').slice(0, 10)
                        })
                    })

                form.addEventListener('submit', async (event) => {
                    event.preventDefault()
                    showPacienteStatus('', 'info')

                    const payload = {
                        nombre: form.nombre.value.trim(),
                        apellido: form.apellido.value.trim(),
                        fechaNacimiento: form.fechaNacimiento.value,
                        lugarNacimiento: form.lugarNacimiento.value.trim(),
                        direccion: form.direccion.value.trim(),
                        sexo: sexoSelect?.value || 'M',
                        profesion: form.profesion.value.trim() || undefined,
                        idDocumento: form.idDocumento.value ? Number(form.idDocumento.value) : undefined,
                        idHistorial: form.idHistorial.value ? Number(form.idHistorial.value) : undefined
                    }

                    const originalText = submitBtn.innerHTML
                    submitBtn.disabled = true
                    submitBtn.innerHTML = '<span style="opacity:0.7;">Guardando...</span>'

                    try {
                        const response = await fetch('/api/pacientes', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        })
                        const data = await response.json()
                        if (!response.ok) {
                            throw new Error(data.error || 'No se pudo registrar el paciente.')
                        }

                        showPacienteStatus(`Paciente registrado (ID ${data.id ?? 'pendiente'})`, 'success')
                        form.reset()
                        if (sexoSelect) sexoSelect.value = 'M'
                        await fetchPacientes()
                    } catch (error) {
                        showPacienteStatus(error.message, 'error')
                    } finally {
                        submitBtn.disabled = false
                        submitBtn.innerHTML = originalText
                    }
                })

                refreshBtn?.addEventListener('click', fetchPacientes)
                fetchPacientes()
            }

            async function deletePaciente(id) {
                if (!confirm('¬øEst√°s seguro de que deseas eliminar este paciente?')) return

                try {
                    const response = await fetch(`/api/pacientes/${id}`, {
                        method: 'DELETE'
                    })
                    const data = await response.json()

                    if (!response.ok) {
                        throw new Error(data.error || 'No se pudo eliminar el paciente')
                    }

                    showPacienteStatus('Paciente eliminado correctamente', 'success')
                    await fetchPacientes()
                } catch (error) {
                    console.error('Error deleting paciente:', error)
                    showPacienteStatus(error.message, 'error')
                }
            }
        </script>

        <!-- Modal Manager Script -->
        <script>
            // Custom Modal Manager
            const ModalManager = {
                overlay: null,
                confirmCallback: null,

                init() {
                    this.overlay = document.getElementById('confirmModal');
                    document.getElementById('modalCancel').addEventListener('click', () => this.close());
                    document.getElementById('modalConfirm').addEventListener('click', () => this.confirm());

                    // Close on overlay click
                    this.overlay.addEventListener('click', (e) => {
                        if (e.target === this.overlay) {
                            this.close();
                        }
                    });

                    // Close on ESC key
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && this.overlay.classList.contains('active')) {
                            this.close();
                        }
                    });
                },

                show({
                    title,
                    message,
                    detailLabel = null,
                    detailValue = null,
                    confirmText = 'Confirmar',
                    cancelText = 'Cancelar',
                    type = 'danger',
                    onConfirm
                }) {
                    document.getElementById('modalTitle').textContent = title;
                    document.getElementById('modalMessage').textContent = message;

                    const detailBox = document.getElementById('modalDetailBox');
                    if (detailLabel && detailValue) {
                        document.getElementById('modalDetailLabel').textContent = detailLabel;
                        document.getElementById('modalDetailValue').textContent = detailValue;
                        detailBox.style.display = 'block';
                    } else {
                        detailBox.style.display = 'none';
                    }

                    // Update button texts
                    document.getElementById('modalConfirm').querySelector('span').textContent = confirmText;
                    document.getElementById('modalCancel').querySelector('span').textContent = cancelText;

                    // Update modal type (danger or warning)
                    const icon = document.querySelector('.modal-icon');
                    const confirmBtn = document.getElementById('modalConfirm');

                    icon.className = 'modal-icon ' + type;
                    if (type === 'danger') {
                        icon.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i>';
                        confirmBtn.className = 'modal-btn modal-btn-danger';
                    } else if (type === 'warning') {
                        icon.innerHTML = '<i class="bi bi-exclamation-circle-fill"></i>';
                        confirmBtn.className = 'modal-btn modal-btn-primary';
                    }

                    this.confirmCallback = onConfirm;
                    this.overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                },

                close() {
                    this.overlay.classList.remove('active');
                    document.body.style.overflow = '';
                    this.confirmCallback = null;

                    // Reset loading state
                    const confirmBtn = document.getElementById('modalConfirm');
                    confirmBtn.classList.remove('loading');
                    confirmBtn.disabled = false;
                },

                async confirm() {
                    if (this.confirmCallback) {
                        const confirmBtn = document.getElementById('modalConfirm');
                        confirmBtn.classList.add('loading');
                        confirmBtn.disabled = true;

                        try {
                            await this.confirmCallback();
                            this.close();
                        } catch (error) {
                            confirmBtn.classList.remove('loading');
                            confirmBtn.disabled = false;
                            // Keep modal open on error so user can see the error message
                        }
                    }
                }
            };

            // Initialize modal on DOM ready
            document.addEventListener('DOMContentLoaded', () => {
                ModalManager.init();
            });
        </script>

        <!-- Especialidades Interactive Script -->
        <script>
            // Especialidades Management
            const especialidadesDB = [];

            function initEspecialidades() {
                const especialidadForm = document.getElementById('especialidadForm');
                const searchInput = document.getElementById('searchSpecialty');
                const specialtyFormMessage = document.getElementById('specialtyFormMessage');

                if (especialidadForm) {
                    // Form submission
                    especialidadForm.addEventListener('submit', async function (e) {
                        e.preventDefault();

                        const nombre = document.getElementById('nombreEspecialidad').value.trim();
                        const especialidadId = document.getElementById('especialidadId').value;
                        const isEditMode = especialidadId && especialidadId !== '';

                        // Add loading state
                        const submitBtn = especialidadForm.querySelector('.btn-primary-custom');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML = `<span style="opacity: 0.6;">${isEditMode ? 'Actualizando...' : 'Agregando...'}</span>`;
                        submitBtn.disabled = true;

                        try {
                            // Choose endpoint and method based on mode
                            const url = isEditMode ? `/api/especialidades/${especialidadId}` : '/api/especialidades';
                            const method = isEditMode ? 'PUT' : 'POST';

                            const response = await fetch(url, {
                                method: method,
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ nombre })
                            });
                            // Simulate API call
                            setTimeout(() => {
                                const newSpecialty = {
                                    id: Date.now(),
                                    nombre: nombre,
                                    descripcion: descripcion || 'Sin descripci√≥n',
                                    icono: icono || 'heart-pulse',
                                    fechaCreacion: new Date().toLocaleDateString('es-AR')
                                };

                                const data = await response.json();

                                if (response.ok) {
                                    await loadEspecialidades();
                                    especialidadForm.reset();
                                    document.getElementById('especialidadId').value = '';

                                    // Reset form title
                                    const formTitle = especialidadForm.closest('.specialty-form-panel').querySelector('h4');
                                    if (formTitle) {
                                        formTitle.textContent = 'Nueva Especialidad';
                                    }

                                    // Reset button text
                                    submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i><span>Agregar Especialidad</span>';

                                    showSpecialtyMessage(isEditMode ? '‚úì Especialidad actualizada exitosamente' : '‚úì Especialidad agregada exitosamente', 'success');
                                } else {
                                    showSpecialtyMessage('Error: ' + data.error, 'error');
                                }
                            } catch (error) {
                                showSpecialtyMessage(`Error al ${isEditMode ? 'actualizar' : 'agregar'} especialidad: ` + error.message, 'error');
                            } finally {
                                submitBtn.innerHTML = originalText;
                                submitBtn.disabled = false;
                            }
                        });
                }

                // Search functionality
                if (searchInput) {
                    searchInput.addEventListener('input', function () {
                        renderEspecialidades(this.value.toLowerCase());
                    });
                }

                // Load data from API
                loadEspecialidades();
            }

            async function loadEspecialidades() {
                try {
                    const response = await fetch('/api/especialidades');
                    const data = await response.json();

                    especialidadesDB.length = 0;
                    especialidadesDB.push(...data.map(esp => ({
                        id: esp.ID_ESPECIALIDAD,
                        nombre: esp.NOMBRE,
                        fechaCreacion: new Date().toLocaleDateString('es-AR')
                    })));

                    renderEspecialidades();
                } catch (error) {
                    console.error('Error al cargar especialidades:', error);
                }
            }

            function renderEspecialidades(searchTerm = '') {
                const listContainer = document.getElementById('specialtiesList');
                const countElement = document.getElementById('specialtyCount');

                if (!listContainer) return;

                const filtered = especialidadesDB.filter(esp =>
                    esp.nombre.toLowerCase().includes(searchTerm) ||
                    esp.descripcion.toLowerCase().includes(searchTerm)
                );

                if (countElement) {
                    countElement.textContent = filtered.length;
                }

                if (filtered.length === 0) {
                    listContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="bi bi-inbox"></i>
                        </div>
                        <p>${searchTerm ? 'No se encontraron resultados' : 'No hay especialidades registradas'}</p>
                        <small>${searchTerm ? 'Intenta con otros t√©rminos de b√∫squeda' : 'Comienza agregando una nueva especialidad'}</small>
                    </div>
                `;
                    return;
                }

                const iconMap = {
                    'heart-pulse': 'üíì',
                    'bandaid': 'ü©π',
                    'brain': 'üß†',
                    'lungs': 'ü´Å',
                    'eye': 'üëÅÔ∏è',
                    'ear': 'üëÇ',
                    'bone': 'ü¶¥',
                    'baby': 'üë∂',
                    'gender-female': 'ü§∞',
                    'tooth': 'ü¶∑',
                    'skin': 'üî¨',
                    'kidney': 'ü´ò',
                    'stomach': 'ü´É'
                };

                listContainer.innerHTML = filtered.map((esp, index) => `
                <div class="specialty-card" style="animation-delay: ${index * 0.05}s">
                    <div class="specialty-info">
                        <h5>${esp.nombre}</h5>
                        <small class="specialty-meta">
                            <i class="bi bi-calendar3"></i> Registrada el ${esp.fechaCreacion}
                        </small>
                    </div>
                    <div class="specialty-actions">
                        <button class="btn-icon-action" title="Editar" onclick="editSpecialty(${esp.id})">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn-icon-action danger" title="Eliminar" onclick="deleteSpecialty(${esp.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            }

            function resetEspecialidadForm() {
                const form = document.getElementById('especialidadForm');
                if (form) {
                    form.reset();
                    document.getElementById('especialidadId').value = '';

                    // Reset form title
                    const formTitle = document.querySelector('.specialty-form-panel h4');
                    if (formTitle) {
                        formTitle.textContent = 'Nueva Especialidad';
                    }

                    // Reset submit button text
                    const submitBtn = form.querySelector('.btn-primary-custom');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i><span>Agregar Especialidad</span>';
                    }
                }
            }

            function editSpecialty(id) {
                const specialty = especialidadesDB.find(e => e.id === id);
                if (specialty) {
                    // Set the specialty ID for edit mode
                    document.getElementById('especialidadId').value = specialty.id;

                    // Fill the form
                    document.getElementById('nombreEspecialidad').value = specialty.nombre;

                    // Update form title
                    const formTitle = document.querySelector('.specialty-form-panel h4');
                    if (formTitle) {
                        formTitle.textContent = 'Editar Especialidad';
                    }

                    // Update submit button text
                    const submitBtn = document.querySelector('#especialidadForm .btn-primary-custom');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="bi bi-pencil me-2"></i><span>Actualizar Especialidad</span>';
                    }

                    // Focus on the input
                    document.getElementById('nombreEspecialidad').focus();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            async function deleteSpecialty(id) {
                const specialty = especialidadesDB.find(e => e.id === id);
                if (!specialty) return;

                ModalManager.show({
                    title: '¬øEliminar Especialidad?',
                    message: 'Esta acci√≥n no se puede deshacer. Todos los datos asociados a esta especialidad se perder√°n permanentemente.',
                    detailLabel: 'Especialidad a eliminar',
                    detailValue: specialty.nombre,
                    confirmText: 'Eliminar',
                    cancelText: 'Cancelar',
                    type: 'danger',
                    onConfirm: async () => {
                        try {
                            const response = await fetch(`/api/especialidades/${id}`, {
                                method: 'DELETE'
                            });

                            const data = await response.json();

                            if (response.ok) {
                                await loadEspecialidades();
                                showSpecialtyMessage('‚úì Especialidad eliminada exitosamente', 'success');
                            } else {
                                showSpecialtyMessage('Error: ' + data.error, 'error');
                                throw new Error(data.error);
                            }
                        } catch (error) {
                            showSpecialtyMessage('Error al eliminar especialidad: ' + error.message, 'error');
                            throw error;
                        }
                    }
                });
            }

            function showSpecialtyMessage(message, type) {
                const messageEl = document.getElementById('specialtyFormMessage');
                if (messageEl) {
                    messageEl.textContent = message;
                    messageEl.className = 'form-message ' + type;
                    messageEl.style.display = 'block';

                    setTimeout(() => {
                        messageEl.style.opacity = '0';
                        setTimeout(() => {
                            messageEl.style.display = 'none';
                            messageEl.style.opacity = '1';
                        }, 300);
                    }, 3000);
                }
            }
        </script>

        <!-- M√©dicos Management Script -->
        <script>
            // M√©dicos database
            const medicosDB = [];

            async function loadEspecialidadesForMedicos() {
                try {
                    const response = await fetch('/api/especialidades');
                    const especialidades = await response.json();

                    // Cargar en el filtro de especialidades
                    const filterSelect = document.getElementById('filterEspecialidad');
                    if (filterSelect) {
                        const currentValue = filterSelect.value;
                        filterSelect.innerHTML = '<option value="">Todas las especialidades</option>';
                        especialidades.forEach(esp => {
                            const option = document.createElement('option');
                            option.value = esp.ID_ESPECIALIDAD;
                            option.textContent = esp.NOMBRE;
                            filterSelect.appendChild(option);
                        });
                        filterSelect.value = currentValue;
                    }

                    // Cargar en el formulario de registro
                    const formSelect = document.getElementById('especialidad');
                    if (formSelect) {
                        const currentValue = formSelect.value;
                        formSelect.innerHTML = '<option value="" disabled selected></option>';
                        especialidades.forEach(esp => {
                            const option = document.createElement('option');
                            option.value = esp.ID_ESPECIALIDAD;
                            option.textContent = esp.NOMBRE;
                            formSelect.appendChild(option);
                        });
                        if (currentValue) formSelect.value = currentValue;
                    }
                } catch (error) {
                    console.error('Error al cargar especialidades:', error);
                }
            }

            function initMedicos() {
                const btnAgregarMedico = document.getElementById('btnAgregarMedico');
                const btnVolverLista = document.getElementById('btnVolverLista');
                const searchInput = document.getElementById('searchMedico');
                const filterEspecialidad = document.getElementById('filterEspecialidad');
                const medicosListView = document.getElementById('medicosListView');
                const medicosFormView = document.getElementById('medicosFormView');

                // Cargar especialidades primero
                loadEspecialidadesForMedicos();

                if (btnAgregarMedico) {
                    btnAgregarMedico.addEventListener('click', function () {
                        // Reset form for new medico
                        const form = document.getElementById('registroMedicoForm');
                        if (form) {
                            form.reset();
                            document.getElementById('medicoId').value = '';

                            // Reset all checkboxes
                            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                            checkboxes.forEach(cb => cb.checked = false);

                            // Reset form title
                            const formHeader = document.querySelector('.form-header h3');
                            if (formHeader) {
                                formHeader.textContent = 'Registrar Nuevo M√©dico';
                            }

                            // Reset submit button text
                            const submitBtn = form.querySelector('.btn-primary-custom');
                            if (submitBtn) {
                                submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i><span>Registrar M√©dico</span>';
                            }
                        }

                        medicosListView.style.display = 'none';
                        medicosFormView.style.display = 'block';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                }

                if (btnVolverLista) {
                    btnVolverLista.addEventListener('click', function () {
                        // Reset form when going back
                        const form = document.getElementById('registroMedicoForm');
                        if (form) {
                            form.reset();
                            document.getElementById('medicoId').value = '';

                            // Reset all checkboxes
                            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                            checkboxes.forEach(cb => cb.checked = false);

                            // Reset form title
                            const formHeader = document.querySelector('.form-header h3');
                            if (formHeader) {
                                formHeader.textContent = 'Registrar Nuevo M√©dico';
                            }

                            // Reset submit button text
                            const submitBtn = form.querySelector('.btn-primary-custom');
                            if (submitBtn) {
                                submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i><span>Registrar M√©dico</span>';
                            }
                        }

                        medicosFormView.style.display = 'none';
                        medicosListView.style.display = 'block';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                }

                // Search functionality
                if (searchInput) {
                    searchInput.addEventListener('input', function () {
                        const specialty = filterEspecialidad ? filterEspecialidad.value : '';
                        renderMedicos(this.value.toLowerCase(), specialty);
                    });
                }

                // Filter functionality
                if (filterEspecialidad) {
                    filterEspecialidad.addEventListener('change', function () {
                        const search = searchInput ? searchInput.value.toLowerCase() : '';
                        renderMedicos(search, this.value);
                    });
                }

                // Load data from API
                loadMedicos();
            }

            async function loadMedicos() {
                try {
                    const response = await fetch('/api/medicos');
                    const data = await response.json();

                    medicosDB.length = 0;
                    medicosDB.push(...data.map(medico => {
                        // Formatear fecha de nacimiento
                        let fechaNacimiento = 'No disponible';
                        if (medico.FECHA_NACIMIENTO) {
                            const fecha = new Date(medico.FECHA_NACIMIENTO);
                            fechaNacimiento = fecha.toLocaleDateString('es-AR');
                        }

                        // Calcular edad
                        let edad = '';
                        if (medico.FECHA_NACIMIENTO) {
                            const hoy = new Date();
                            const nacimiento = new Date(medico.FECHA_NACIMIENTO);
                            let edadCalculada = hoy.getFullYear() - nacimiento.getFullYear();
                            const mes = hoy.getMonth() - nacimiento.getMonth();
                            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                                edadCalculada--;
                            }
                            edad = `${edadCalculada} a√±os`;
                        }

                        // Formatear horario de atenci√≥n
                        let horario = 'Horario no configurado';
                        let diasAtencion = [];
                        if (medico.HORA_INICIO && medico.HORA_FIN) {
                            // Formatear las horas (eliminar segundos si existen)
                            const horaInicio = medico.HORA_INICIO.substring(0, 5);
                            const horaFin = medico.HORA_FIN.substring(0, 5);
                            horario = `${horaInicio} - ${horaFin}`;

                            if (medico.DIAS_ATENCION) {
                                diasAtencion = medico.DIAS_ATENCION.split(',');
                            }
                        }

                        return {
                            id: medico.ID_MEDICO,
                            nombre: medico.NOMBRE,
                            apellido: medico.APELLIDO,
                            dni: medico.NRO_DOCUMENTO,
                            tipoDocumento: medico.TIPO_DOCUMENTO,
                            fechaNacimiento: fechaNacimiento,
                            edad: edad,
                            especialidad: medico.ID_ESPECIALIDAD,
                            especialidadNombre: medico.ESPECIALIDAD_NOMBRE || 'Sin especialidad',
                            matricula: medico.MATRICULA,
                            email: medico.EMAIL || 'Sin email',
                            telefono: medico.TELEFONO || 'Sin tel√©fono',
                            horario: horario,
                            diasAtencion: diasAtencion,
                            horaInicio: medico.HORA_INICIO ? medico.HORA_INICIO.substring(0, 5) : '',
                            horaFin: medico.HORA_FIN ? medico.HORA_FIN.substring(0, 5) : ''
                        };
                    }));

                    renderMedicos();
                } catch (error) {
                    console.error('Error al cargar m√©dicos:', error);
                }
            }

            function renderMedicos(searchTerm = '', specialtyFilter = '') {
                const listContainer = document.getElementById('medicosList');
                const countElement = document.getElementById('medicosCount');

                if (!listContainer) return;

                const filtered = medicosDB.filter(medico => {
                    const matchesSearch =
                        medico.nombre.toLowerCase().includes(searchTerm) ||
                        medico.apellido.toLowerCase().includes(searchTerm) ||
                        medico.matricula.toLowerCase().includes(searchTerm);
                    const matchesSpecialty = !specialtyFilter || medico.especialidad === specialtyFilter;
                    return matchesSearch && matchesSpecialty;
                });

                if (countElement) {
                    countElement.textContent = filtered.length;
                }

                if (filtered.length === 0) {
                    listContainer.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">
                            <i class="bi bi-person-x"></i>
                        </div>
                        <p>${searchTerm || specialtyFilter ? 'No se encontraron m√©dicos' : 'No hay m√©dicos registrados'}</p>
                        <small>${searchTerm || specialtyFilter ? 'Intenta con otros criterios de b√∫squeda' : 'Comienza agregando un nuevo profesional m√©dico'}</small>
                    </div>
                `;
                    return;
                }

                listContainer.innerHTML = filtered.map(medico => {
                    const initials = `${medico.nombre.charAt(0)}${medico.apellido.charAt(0)}`.toUpperCase();

                    // Formatear d√≠as de atenci√≥n
                    let diasTexto = '';
                    if (medico.diasAtencion && medico.diasAtencion.length > 0) {
                        const diasMap = {
                            'lunes': 'Lun',
                            'martes': 'Mar',
                            'miercoles': 'Mi√©',
                            'jueves': 'Jue',
                            'viernes': 'Vie',
                            'sabado': 'S√°b',
                            'domingo': 'Dom'
                        };
                        diasTexto = medico.diasAtencion.map(d => diasMap[d] || d).join(', ');
                    }

                    return `
                    <div class="medico-card">
                        <div class="medico-avatar">${initials}</div>
                        <div class="medico-name">Dr. ${medico.nombre} ${medico.apellido}</div>
                        <div class="medico-specialty">${medico.especialidadNombre || 'Sin especialidad'}</div>
                        <div class="medico-info">
                            <div class="medico-info-item">
                                <i class="bi bi-card-text"></i>
                                <span>Mat. ${medico.matricula}</span>
                            </div>
                            <div class="medico-info-item">
                                <i class="bi bi-clock"></i>
                                <span>${medico.horario}</span>
                            </div>
                            ${diasTexto ? `<div class="medico-info-item">
                                <i class="bi bi-calendar-week"></i>
                                <span>${diasTexto}</span>
                            </div>` : ''}
                            <div class="medico-info-item">
                                <i class="bi bi-envelope"></i>
                                <span>${medico.email}</span>
                            </div>
                            <div class="medico-info-item">
                                <i class="bi bi-telephone"></i>
                                <span>${medico.telefono}</span>
                            </div>
                        </div>
                        <div class="medico-actions">
                            <button class="btn-icon-action" title="Ver detalles" onclick="viewMedico(${medico.id})">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn-icon-action" title="Editar" onclick="editMedico(${medico.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-icon-action danger" title="Eliminar" onclick="deleteMedico(${medico.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                }).join('');
            }

            function viewMedico(id) {
                const medico = medicosDB.find(m => m.id === id);
                if (!medico) return;

                // Set modal title
                document.getElementById('medicoDetailsName').textContent = `Dr. ${medico.nombre} ${medico.apellido}`;

                // Set personal information
                document.getElementById('detailDocumento').textContent = `${medico.tipoDocumento.toUpperCase()} ${medico.dni}`;
                document.getElementById('detailFechaNacimiento').textContent = medico.fechaNacimiento || 'No disponible';

                // Show/hide age row
                if (medico.edad) {
                    document.getElementById('detailEdadRow').style.display = 'grid';
                    document.getElementById('detailEdad').textContent = medico.edad;
                } else {
                    document.getElementById('detailEdadRow').style.display = 'none';
                }

                // Set professional information
                document.getElementById('detailEspecialidad').textContent = medico.especialidadNombre || 'Sin especialidad';
                document.getElementById('detailMatricula').textContent = medico.matricula;

                // Set schedule information
                document.getElementById('detailHorario').textContent = medico.horario;

                // Set d√≠as de atenci√≥n with badges
                const diasContainer = document.getElementById('detailDias');
                if (medico.diasAtencion && medico.diasAtencion.length > 0) {
                    const diasMap = {
                        'lunes': 'Lunes',
                        'martes': 'Martes',
                        'miercoles': 'Mi√©rcoles',
                        'jueves': 'Jueves',
                        'viernes': 'Viernes',
                        'sabado': 'S√°bado',
                        'domingo': 'Domingo'
                    };
                    diasContainer.innerHTML = medico.diasAtencion
                        .map(dia => `<span class="dia-badge">${diasMap[dia] || dia}</span>`)
                        .join('');
                } else {
                    diasContainer.innerHTML = 'No configurado';
                }

                // Set contact information
                document.getElementById('detailEmail').textContent = medico.email || 'Sin email';
                document.getElementById('detailTelefono').textContent = medico.telefono || 'Sin tel√©fono';

                // Show modal
                const modal = document.getElementById('medicoDetailsModal');
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // Initialize medico details modal close handlers
            document.addEventListener('DOMContentLoaded', function () {
                const modal = document.getElementById('medicoDetailsModal');
                const closeBtn = document.getElementById('closeMedicoDetails');
                const closeDetailBtn = document.getElementById('closeDetailBtn');

                function closeMedicoModal() {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }

                if (closeBtn) {
                    closeBtn.addEventListener('click', closeMedicoModal);
                }

                if (closeDetailBtn) {
                    closeDetailBtn.addEventListener('click', closeMedicoModal);
                }

                // Close on overlay click
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) {
                        closeMedicoModal();
                    }
                });

                // Close on ESC key
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' && modal.classList.contains('active')) {
                        closeMedicoModal();
                    }
                });
            });

            function editMedico(id) {
                const medico = medicosDB.find(m => m.id === id);
                if (medico) {
                    // Show form view
                    document.getElementById('medicosListView').style.display = 'none';
                    document.getElementById('medicosFormView').style.display = 'block';

                    // Set the medico ID for edit mode
                    document.getElementById('medicoId').value = medico.id;

                    // Update form title
                    const formHeader = document.querySelector('.form-header h3');
                    if (formHeader) {
                        formHeader.textContent = 'Editar M√©dico';
                    }

                    // Update submit button text
                    const submitBtn = document.querySelector('#registroMedicoForm .btn-primary-custom');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i><span>Actualizar M√©dico</span>';
                    }

                    // Fill form with data
                    document.getElementById('nombre').value = medico.nombre;
                    document.getElementById('apellido').value = medico.apellido;
                    document.getElementById('tipoDocumento').value = medico.tipoDocumento;
                    document.getElementById('dni').value = medico.dni;

                    // Convertir fecha al formato YYYY-MM-DD para el input type="date"
                    if (medico.fechaNacimiento && medico.fechaNacimiento !== 'No disponible') {
                        const partes = medico.fechaNacimiento.split('/');
                        if (partes.length === 3) {
                            const fechaISO = `${partes[2]}-${partes[1].padStart(2, '0')}-${partes[0].padStart(2, '0')}`;
                            document.getElementById('fechaNacimiento').value = fechaISO;
                        }
                    }

                    document.getElementById('matricula').value = medico.matricula;
                    document.getElementById('especialidad').value = medico.especialidad;
                    document.getElementById('email').value = medico.email;
                    document.getElementById('telefono').value = medico.telefono;

                    // Cargar horarios
                    if (medico.horaInicio) {
                        document.getElementById('horaInicio').value = medico.horaInicio;
                    }
                    if (medico.horaFin) {
                        document.getElementById('horaFin').value = medico.horaFin;
                    }

                    // Cargar d√≠as de atenci√≥n
                    if (medico.diasAtencion && medico.diasAtencion.length > 0) {
                        medico.diasAtencion.forEach(dia => {
                            const checkbox = document.getElementById(dia);
                            if (checkbox) {
                                checkbox.checked = true;
                            }
                        });
                    }

                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            async function deleteMedico(id) {
                const medico = medicosDB.find(m => m.id === id);
                if (!medico) return;

                ModalManager.show({
                    title: '¬øEliminar M√©dico?',
                    message: 'Esta acci√≥n eliminar√° permanentemente todos los datos del m√©dico, incluyendo su historial y asignaciones.',
                    detailLabel: 'M√©dico a eliminar',
                    detailValue: `Dr. ${medico.nombre} ${medico.apellido}`,
                    confirmText: 'Eliminar',
                    cancelText: 'Cancelar',
                    type: 'danger',
                    onConfirm: async () => {
                        try {
                            const response = await fetch(`/api/medicos/${id}`, {
                                method: 'DELETE'
                            });

                            const data = await response.json();

                            if (response.ok) {
                                await loadMedicos();
                                // Show success message (you can add a toast notification here)
                            } else {
                                alert('Error al eliminar m√©dico: ' + data.error);
                                throw new Error(data.error);
                            }
                        } catch (error) {
                            alert('Error al eliminar m√©dico: ' + error.message);
                            throw error;
                        }
                    }
                });
            }
        </script>

        <!-- Registro M√©dico Interactive Script -->
        <script>
            // Form validation and interactivity
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize pacientes if on that section
                if (document.getElementById('pacienteForm')) {
                    initPacientes();
                }

                // Initialize medicos if on that section
                if (document.getElementById('medicosListView')) {
                    initMedicos();
                }

                // Initialize especialidades if on that section
                if (document.getElementById('especialidadForm')) {
                    initEspecialidades();
                }
                const registroForm = document.getElementById('registroMedicoForm');
                const formMessage = document.getElementById('formMessage');

                if (registroForm) {
                    // Tipo de documento interactivity
                    const tipoDocSelect = document.getElementById('tipoDocumento');
                    const dniInput = document.getElementById('dni');
                    const dniHint = dniInput?.parentElement.querySelector('.field-hint');

                    if (tipoDocSelect && dniInput) {
                        tipoDocSelect.addEventListener('change', function () {
                            const tipo = this.value;

                            // Add highlight animation
                            dniInput.classList.add('documento-field-highlight');
                            setTimeout(() => {
                                dniInput.classList.remove('documento-field-highlight');
                            }, 600);

                            switch (tipo) {
                                case 'cedula':
                                    dniInput.setAttribute('pattern', '[0-9]{7,8}');
                                    dniInput.setAttribute('maxlength', '8');
                                    if (dniHint) dniHint.textContent = '7-8 d√≠gitos';
                                    break;
                                case 'dni':
                                    dniInput.setAttribute('pattern', '[0-9]{7,8}');
                                    dniInput.setAttribute('maxlength', '8');
                                    if (dniHint) dniHint.textContent = '7-8 d√≠gitos';
                                    break;
                                case 'pasaporte':
                                    dniInput.setAttribute('pattern', '[A-Z0-9]{6,12}');
                                    dniInput.removeAttribute('maxlength');
                                    if (dniHint) dniHint.textContent = 'Letras y n√∫meros';
                                    break;
                            }
                            dniInput.value = '';
                            dniInput.focus();
                        });
                    }

                    // Add smooth focus animations to inputs
                    const inputs = registroForm.querySelectorAll('.form-control-custom');
                    inputs.forEach(input => {
                        // Auto-format DNI input based on document type
                        if (input.id === 'dni') {
                            input.addEventListener('input', function (e) {
                                const tipoDoc = tipoDocSelect?.value;
                                if (tipoDoc === 'pasaporte') {
                                    this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 12);
                                } else {
                                    this.value = this.value.replace(/\D/g, '').slice(0, 8);
                                }
                            });
                        }

                        // Auto-format phone input
                        if (input.id === 'telefono') {
                            input.addEventListener('input', function (e) {
                                this.value = this.value.replace(/\D/g, '').slice(0, 10);
                            });
                        }

                        // Auto-format matricula input (only numbers)
                        if (input.id === 'matricula') {
                            input.addEventListener('input', function (e) {
                                this.value = this.value.replace(/\D/g, '');
                            });
                        }

                        // Add ripple effect on focus
                        input.addEventListener('focus', function () {
                            this.parentElement.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                            this.parentElement.style.transform = 'scale(1.01)';
                        });

                        input.addEventListener('blur', function () {
                            this.parentElement.style.transform = 'scale(1)';
                        });
                    });

                    // Checkbox interactions
                    const checkboxes = registroForm.querySelectorAll('.dia-checkbox input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const label = this.nextElementSibling;
                            if (this.checked) {
                                // Stagger animation for visual feedback
                                label.style.animation = 'none';
                                setTimeout(() => {
                                    label.style.animation = 'pulse 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                                }, 10);
                            }
                        });
                    });

                    // Form submission handler
                    registroForm.addEventListener('submit', async function (e) {
                        e.preventDefault();

                        // Check if we're in edit mode
                        const medicoId = document.getElementById('medicoId').value;
                        const isEditMode = medicoId && medicoId !== '';

                        // Add loading state
                        registroForm.classList.add('form-loading');
                        const submitBtn = registroForm.querySelector('.btn-primary-custom');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML = `<span style="opacity: 0.6;">${isEditMode ? 'Actualizando...' : 'Registrando...'}</span>`;

                        // Validate at least one day is selected
                        const diasSeleccionados = registroForm.querySelectorAll('input[name="dias[]"]:checked');
                        if (diasSeleccionados.length === 0) {
                            showMessage('Por favor selecciona al menos un d√≠a de atenci√≥n', 'error');
                            registroForm.classList.remove('form-loading');
                            submitBtn.innerHTML = originalText;
                            return;
                        }

                        // Collect form data
                        const formData = new FormData(registroForm);
                        const data = {};

                        // Convert FormData to object
                        for (let [key, value] of formData.entries()) {
                            if (key === 'dias[]') {
                                if (!data.dias) data.dias = [];
                                data.dias.push(value);
                            } else {
                                data[key] = value;
                            }
                        }

                        // Validate required numeric fields
                        if (!data.dni || data.dni.trim() === '') {
                            showMessage('El n√∫mero de documento es requerido', 'error');
                            registroForm.classList.remove('form-loading');
                            submitBtn.innerHTML = originalText;
                            return;
                        }

                        if (!data.matricula || data.matricula.trim() === '') {
                            showMessage('La matr√≠cula profesional es requerida', 'error');
                            registroForm.classList.remove('form-loading');
                            submitBtn.innerHTML = originalText;
                            return;
                        }

                        if (!data.especialidad || data.especialidad === '') {
                            showMessage('Debes seleccionar una especialidad', 'error');
                            registroForm.classList.remove('form-loading');
                            submitBtn.innerHTML = originalText;
                            return;
                        }

                        try {
                            // Prepare data for API
                            const medicoData = {
                                nombre: data.nombre,
                                apellido: data.apellido,
                                tipoDocumento: data.tipoDocumento,
                                nroDocumento: parseInt(data.dni),
                                fechaNacimiento: data.fechaNacimiento,
                                matricula: parseInt(data.matricula),
                                idEspecialidad: parseInt(data.especialidad),
                                email: data.email,
                                telefono: data.telefono,
                                idSucursal: null,
                                horaInicio: data.horaInicio,
                                horaFin: data.horaFin,
                                diasAtencion: data.dias ? data.dias.join(',') : null
                            };

                            console.log('Datos a enviar:', medicoData);
                            console.log('Modo edici√≥n:', isEditMode);

                            // Choose endpoint and method based on mode
                            const url = isEditMode ? `/api/medicos/${medicoId}` : '/api/medicos';
                            const method = isEditMode ? 'PUT' : 'POST';

                            const response = await fetch(url, {
                                method: method,
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(medicoData)
                            });

                            const result = await response.json();

                            if (response.ok) {
                                // Show success message
                                showMessage(isEditMode ? '¬°M√©dico actualizado exitosamente!' : '¬°M√©dico registrado exitosamente!', 'success');

                                // Reset form and go back to list after success
                                setTimeout(() => {
                                    registroForm.reset();
                                    checkboxes.forEach(cb => cb.checked = false);
                                    document.getElementById('medicoId').value = '';

                                    // Go back to list view and reload data
                                    document.getElementById('medicosFormView').style.display = 'none';
                                    document.getElementById('medicosListView').style.display = 'block';
                                    loadMedicos();
                                    window.scrollTo({ top: 0, behavior: 'smooth' });
                                }, 1500);
                            } else {
                                showMessage('Error: ' + result.error, 'error');
                            }
                        } catch (error) {
                            showMessage(`Error al ${isEditMode ? 'actualizar' : 'registrar'} m√©dico: ` + error.message, 'error');
                        } finally {
                            registroForm.classList.remove('form-loading');
                            submitBtn.innerHTML = originalText;
                        }
                    });

                    // Cancel button handler
                    const cancelBtn = registroForm.querySelector('.btn-secondary-custom');
                    if (cancelBtn) {
                        cancelBtn.addEventListener('click', function () {
                            const medicoId = document.getElementById('medicoId').value;
                            const isEditMode = medicoId && medicoId !== '';

                            ModalManager.show({
                                title: '¬øCancelar registro?',
                                message: isEditMode
                                    ? 'Los cambios realizados no se guardar√°n.'
                                    : 'Se perder√°n todos los datos ingresados en el formulario.',
                                confirmText: 'S√≠, cancelar',
                                cancelText: 'Continuar editando',
                                type: 'warning',
                                onConfirm: async () => {
                                    registroForm.reset();
                                    checkboxes.forEach(cb => cb.checked = false);
                                    formMessage.style.display = 'none';
                                    document.getElementById('medicoId').value = '';

                                    // Go back to list view if exists
                                    const medicosFormView = document.getElementById('medicosFormView');
                                    const medicosListView = document.getElementById('medicosListView');
                                    if (medicosFormView && medicosListView) {
                                        medicosFormView.style.display = 'none';
                                        medicosListView.style.display = 'block';
                                    }

                                    // Scroll to top smoothly
                                    window.scrollTo({
                                        top: 0,
                                        behavior: 'smooth'
                                    });
                                }
                            });
                        });
                    }

                    // Show message helper
                    function showMessage(message, type) {
                        formMessage.textContent = message;
                        formMessage.className = 'form-message ' + type;
                        formMessage.style.display = 'block';

                        // Scroll to message
                        formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                        // Auto-hide success messages
                        if (type === 'success') {
                            setTimeout(() => {
                                formMessage.style.opacity = '0';
                                setTimeout(() => {
                                    formMessage.style.display = 'none';
                                    formMessage.style.opacity = '1';
                                }, 300);
                            }, 5000);
                        }
                    }

                    // Add pulse animation for checkboxes
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.08); }
                        100% { transform: scale(1.05); }
                    }
                `;
                    document.head.appendChild(style);
                }

                // Add parallax effect to ambient glows (optional enhancement)
                const container = document.querySelector('.registro-medico-container');
                if (container && window.innerWidth > 768) {
                    document.addEventListener('mousemove', function (e) {
                        const mouseX = e.clientX / window.innerWidth;
                        const mouseY = e.clientY / window.innerHeight;

                        const glowBefore = container.querySelector('::before');
                        const glowAfter = container.querySelector('::after');

                        // Subtle parallax movement
                        container.style.setProperty('--mouse-x', mouseX);
                        container.style.setProperty('--mouse-y', mouseY);
                    });
                }
            });
        </script>
</body>

</html>